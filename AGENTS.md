#  AI Rules

## 情報のたどり方

※ ファイルパスのルートディレクトリはワーススペースのルートです。

1. 必読: 開始時に @docs/agent/architecture/overview.md および @docs/agent/requires/list.md を読むこと。
2. 規約: @docs/agent/CODING_STYLE.md を厳守すること。
3. 範囲: `docs/agent/**/**.md`、`inc/**/*.hxx`、`src/**/*.cxx`のみ参照すること。

## ワークフロー

進め方のイメージは「盆栽」です。全体をみて気になるところを少し整える、それを繰り返してゆっくり作る。整えたら観察し、フィードバックを求める。整えた結果、課題が出ればそれをすぐに解決するのではなく、一旦棚上げにし、全体に戻る。雑にならない。ステップバイステップで方向性が調整し、進める。互いに影響し合う領域を少しずつ整えて全体を進める流れをイメージしてください。

原則として設計駆動開発です。すべてにおいて設計が先です。エージェントにとって設計が明確であれば実装は派生物でしかありません。構文と実装、トレーサビリティの確保はラピッド開発の回転を遅くするだけであり、設計フェーズでは不要です。

1. 設計タスク
  - ユーザが上位の要件、制約、仕様を提供する。
  - エージェントは詳細仕様に補完、導出する。
  - エージェントは仮の動的（主にシーケンス図）、静的モデル（ブロック図、概要クラス図）を提供する。
  - エージェントは仕様の問題、不足をユーザにフィードバックする。
  - ユーザはフィードバックを元に情報を更新する。
  - ユーザの承認で設計タスクを終了する。
2. インターフェイス定義タスク
  - エージェントがコンポーネント単位でヘッダファイルにインターフェイスを定義する。
  - 不備があればユーザが仕様を改定する。
  - ユーザの承認でインターフェイス定義タスクを終了する。

設計で詳細レベルのシステムの一貫性が成立すると、実装を中心としたラピッド開発の回転が始まります。

1. 実装タスク
  - エージェントがコンポーネント単位でヘッダファイルに従って実装の雛形を作る。
  - ユーザが実装する。
  - エージェントはユーザに要求されたら実装を例示する。
  - ユーザの承認で実装定義タスクを終了する。
2. デバッグタスク
  - 実装に基づいてユニットテストをエージェントが作成する。
  - テストの実行とデバッグはユーザが行う。
  - エージェントはユーザからの問い合わせに答える。
  - ユーザの承認でデバッグタスクを終了する。

実装が終わると振り返りのラピッド開発の回転が始まります。

1. 振り返り
  - できあがった実装を設計と比較し、差分を検証する。
    - 設計がない場合はトップダウンで仕様をまとめ直す。
  - なぜそういう実装になったか分析する。
  - 分析の結果を根本的な問題にリフトアップし、設計をリファイメントし、ユーザにフィードバックする。
    - 責務と仕組みを見直す。
  - 振り返りタスクを終了する。  
2. リファクタリング
  - 振り返りからリファクタリングプランを立てユーザに提示する。
  - リファクタリングプランがユーザに承認されたらプランをひとつずつ確認しながら適用する。

## ドキュメントの生成ルール

ドキュメントを書く際には下記のルールに従う。

1. ドキュメントは原則日本語で記述すること。
2. 図のテキストは英語で記述すること。
3. ドキュメントの設計ができたらタスクを終了すること
4. 設計とコードの生成は必ず別タスクとする。
5. 章・節の頭に全体的な概略を完結に書くこと。
6. 簡潔に書き、意味的に重複がある冗長な表現は避けること。
7. サンプルコードはC#の処理を概念的にPythonで記述すること。
8. 図はMermaid記法で記述すること。

参照するドキュメントは下記の4階層とする。

1. 要求（`docs/agent/requires/*.md`）
2. アーキテクチャ（`docs/agent/architecture/*.md`）
3. コンポーネント（`docs/agent/components/*.md`）
4. パターン（`docs/agent/patterns/*.md`）

生成するドキュメントは下記のフォルダに出力する。具体的なコードではなく高レイヤーの仕様としてまとめること。

1. 要求（`docs/gen/requires/`）
2. アーキテクチャ（`docs/gen/architecture/`）
3. コンポーネント（`docs/gen/components/`）
4. パターン（`docs/gen/patterns/`）

要求とアーキテクチャは、パターンはユーザから提供される。

1. ユーザから提供された情報から、エージェントはコンポーネントを設計することにに注力する。
2. ユーザから提供された細目のことを命題と呼ぶ。
3. 要求の命題からのアーキテクチャの仕様を導出する。
4. アーキテクチャ、パターンの命題からのコンポーネントの仕様を導出する。
5. 導出された仕様は元となる命題を示すこと。
6. 機能仕様、非機能仕様の観点で項目を洗い出すこと。
7. 情報が不足して導出できない場合はユーザに一般的な仕様を提示した上で問い合わせる。
8. 要求からトレーサビリティのない仕様は省略すること。

## ソースコードの生成ルール

1. シェルスクリプト、設定ファイルを含むソースコードのコメントは英語で記述すること。
2. 仕様が決まってない項目は生成しないこと。
3. 仕様に基づきヘッダファイルにインターフェイスを定義すること。
4. インターフェイスが承認された時、それに対応する実装のスタブを生成すること。
5. 実装の中身は要求されない限りは生成しないこと。
